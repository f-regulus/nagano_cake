<div class="container">

<h2>注文履歴詳細</h2>

<table class="table">
  <tbody>
    <tr>
      <td>購入者</td>
      <td>
        <%= link_to admin_order_path(@order) do %>
        <%= @order.custmer.full_name %>
        <% end %>
      </td>
    </tr>
    <tr>
      <td>注文日</td>
      <td> <%= @order.created.at.to_s(:datemime_jp) %></td>
    </tr>
    <tr>
      <td>配送先</td>
      <td><%= @order.custmer.postal_code %>
          <%= @order.custmer.address %>
      </td>
    </tr>
    <tr>
      <td>支払い方法</td>
      <td>
        <%= @order.payment %>
      </td>
    </tr>
    <tr>
      <td>注文ステータス</td>
      <td>
         <%= form_with model:@order, url: admin_order_path do |f| %>
         <%= f.select :status, ["入金待ち", "入金確認","製作中","発送準備中","発送済み"] %>
         <%= f.submit "更新", class: 'btn btn-primary' %>
         <% end %>
      </td>
    </tr>
  </tbody>
</table>
</div>

<!--注文した商品をテーブルで表示-->
<div class="row">
  <div class="col-xs-8">
    <table class='order-show-table table'>
      <thead>
        <tr>
          <th class="active">商品名</th>
          <th class="active">単価（税込）</th>
          <th class="active">数量</th>
          <th class="active">小計</th>
          <th class="active">製作ステータス</th>
        <tr>
      </thead>
      <% @order_details.each do |order_detail| %>
      <tbody>
        <tr>
          <td class="col-xs-4"><%= order_detail.product.name%></td>
          <td class="col-xs-2">¥<%= (order_detail.price*1.1).floor.to_s(:delimited) %></td>
          <td><%= order_detail.amount %></td>
          <td class="col-xs-2">¥<%= ((order_detail.price * order_detail.amount*1.1).floor).to_s(:delimited) %></td>
          <td>
            <%= form_with model:order_detail, url: admin_order_detail_path(order_detail) do |f| %>
              <%= f.select :make_status, ["製作不可", "製作待ち", "製作中", "製作完了"] %>
              <%= f.submit "更新", class: 'btn btn-primary' %>
            <% end %>
          </td>
        </tr>
      </tbody>
      <% end %>
    </table>
  </div>

  <!--注文商品の合計金額表示-->
  <div class="col-xs-4">
    <div>
      <p>
        <strong class="col-xs-3">商品合計</strong>
         ¥<%= (@order.total_fee - @order.shipping).to_s(:delimited)%>
      </p>
    </div>
    <br>

    <div>
      <p>
        <strong class="col-xs-2">送料</strong>
        ¥<%= @order.shipping %>
      </p>
    </div>
    <br>

    <div>
      <p>
        <strong class="col-xs-4">請求金額合計</strong>
        ¥<%= @order.total_fee.to_s(:delimited) %>
      </p>
    </div>
    <br>
  </div>
</div>
</div>